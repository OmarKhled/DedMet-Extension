(()=>{"use strict";const e=function(e){var n=new Date;return{headers:{accept:"application/json, text/javascript, */*; q=0.01","content-type":"application/json",Cookie:"MoodleSession=".concat(e),Connection:"keep-alive"},referrer:"https://courses.nu.edu.eg/my/index.php",referrerPolicy:"strict-origin-when-cross-origin",body:'[{"index":0,"methodname":"core_calendar_get_calendar_monthly_view","args":{"year":'.concat(n.getFullYear(),',"month":').concat(n.getMonth()+1,',"courseid":1,"categoryid":0,"includenavigation":true,"mini":true}}]'),method:"POST",mode:"cors",credentials:"include"}};var n,t=function(e){var t=e.url;if(t.includes("core_calendar_get_calendar_monthly_view")){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){n=e[0].id,console.log(n)}));var r=t.split("=")[1].split("&")[0];setTimeout((function(){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(n,{key:r,type:"sesskey"},(function(e){return console.log(e),o(r,e.cookie),Promise.resolve("Dummy response to keep the console quiet")}))}))}),200)}},o=function(o,r){return c=void 0,i=void 0,a=function(){var c;return function(e,n){var t,o,r,c,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return c={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function s(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,o=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=n.call(e,i)}catch(e){c=[6,e],o=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(i){switch(i.label){case 0:return chrome.webRequest.onBeforeRequest.removeListener(t),[4,fetch("https://courses.nu.edu.eg/lib/ajax/service.php?sesskey=".concat(o,"&info=core_calendar_get_calendar_monthly_view"),e(r))];case 1:return[4,i.sent().json()];case 2:return c=i.sent(),console.log(c),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){if(console.log("starts"),n==e[0].id)console.log("matches"),chrome.tabs.sendMessage(e[0].id,{timeline:c,type:"timeline"});else{console.log("doesn't match");var t=function(e){e.tabId==n&&(chrome.tabs.onActivated.removeListener(t),chrome.tabs.sendMessage(n,{timeline:c,type:"timeline"}))};chrome.tabs.onActivated.addListener(t)}})),[2]}}))},new((s=void 0)||(s=Promise))((function(e,n){function t(e){try{r(a.next(e))}catch(e){n(e)}}function o(e){try{r(a.throw(e))}catch(e){n(e)}}function r(n){var r;n.done?e(n.value):(r=n.value,r instanceof s?r:new s((function(e){e(r)}))).then(t,o)}r((a=a.apply(c,i||[])).next())}));var c,i,s,a};chrome.runtime.onMessage.addListener((function(e,n,o){var r=e.msg;console.log(r),chrome.webRequest.onBeforeRequest.removeListener(t),"/my/index.php"==r&&chrome.webRequest.onBeforeRequest.addListener(t,{urls:["*://courses.nu.edu.eg/*"]}),o("hello")}))})();