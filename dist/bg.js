(()=>{"use strict";const e=function(e){return n=void 0,t=void 0,r=function(){var n,t;return function(e,n){var t,o,r,c,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(c){return function(a){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,o=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=n.call(e,i)}catch(e){c=[6,e],o=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch("".concat("https://dedmet.app","/api/authKey"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e}),mode:"cors"})];case 1:return[4,o.sent().json()];case 2:return n=o.sent(),console.log(n),n.msg?[2,null]:[2,n.user];case 3:return t=o.sent(),console.log(t),[2,null];case 4:return[2]}}))},new((o=void 0)||(o=Promise))((function(e,c){function i(e){try{s(r.next(e))}catch(e){c(e)}}function a(e){try{s(r.throw(e))}catch(e){c(e)}}function s(n){var t;n.done?e(n.value):(t=n.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}s((r=r.apply(n,t||[])).next())}));var n,t,o,r},n=function(e,n){var t=new Date;return{headers:{accept:"application/json, text/javascript, */*; q=0.01","content-type":"application/json",Cookie:"MoodleSession=".concat(e),Connection:"keep-alive"},referrer:"https://courses.nu.edu.eg/my/index.php",referrerPolicy:"strict-origin-when-cross-origin",body:'[{"index":0,"methodname":"core_calendar_get_calendar_monthly_view","args":{"year":'.concat(t.getFullYear(),',"month":').concat(n,',"courseid":1,"categoryid":0,"includenavigation":true,"mini":true}}]'),method:"POST",mode:"cors",credentials:"include"}};var t,o=function(e,n,t,o){return new(t||(t=Promise))((function(r,c){function i(e){try{s(o.next(e))}catch(e){c(e)}}function a(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,a)}s((o=o.apply(e,n||[])).next())}))},r=function(e,n){var t,o,r,c,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(c){return function(a){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,o=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=n.call(e,i)}catch(e){c=[6,e],o=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}},c=!1,i="",a=function(e){var n=e.payload,t=e.callback,o=e.tabId;chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(o,n,t)}))},s=function(n){var s=n.url;return o(void 0,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return console.log("listening"),!s.includes("sesskey")||c?[3,2]:(c=!0,chrome.tabs.query({active:!0,currentWindow:!0},(function(e){t=e[0].id,console.log(t)})),n=s.split("=")[1].split("&")[0],[4,e(i)]);case 1:o=r.sent(),console.log(o),null!=o?setTimeout((function(){a({payload:{key:n,type:"sesskey"},tabId:t,callback:function(e){return console.log(e),l(n,e.cookie),Promise.resolve("Dummy response to keep the console quiet")}})}),200):setTimeout((function(){a({payload:{type:"invalidLicense"},tabId:t,callback:function(e){return console.log(e),Promise.resolve("Dummy response to keep the console quiet")}})}),200),r.label=2;case 2:return[2]}}))}))},l=function(e,i){return o(void 0,void 0,void 0,(function(){var a,l,u,d,f,h;return r(this,(function(p){switch(p.label){case 0:chrome.webRequest.onResponseStarted.removeListener(s),c=!1,a=new Date,l=[a.getMonth()+1,a.getMonth()+2],u=[],l.forEach((function(e){return o(void 0,void 0,void 0,(function(){return r(this,(function(e){return[2]}))}))})),d=0,p.label=1;case 1:return d<l.length?(f=l[d],[4,fetch("https://courses.nu.edu.eg/lib/ajax/service.php?sesskey=".concat(e,"&info=core_calendar_get_calendar_monthly_view"),n(i,f))]):[3,5];case 2:return[4,p.sent().json()];case 3:h=p.sent(),u.push(h[0]),p.label=4;case 4:return d++,[3,1];case 5:return console.log(u),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){if(console.log("starts"),t==e[0].id)console.log("matches"),chrome.tabs.sendMessage(e[0].id,{timeline:u,type:"timeline"});else{console.log("doesn't match");var n=function(e){e.tabId==t&&(chrome.tabs.onActivated.removeListener(n),chrome.tabs.sendMessage(t,{timeline:u,type:"timeline"}))};chrome.tabs.onActivated.addListener(n)}})),[2]}}))}))};chrome.runtime.onMessage.addListener((function(e,n,o){var r=e.msg;console.log(r),chrome.webRequest.onResponseStarted.removeListener(s),r.includes("my")&&chrome.storage.sync.get(null).then((function(e){e.key?(console.log("init"),i=e.key,chrome.webRequest.onResponseStarted.addListener(s,{urls:["*://courses.nu.edu.eg/*"]})):setTimeout((function(){a({payload:{type:"invalidLicense"},tabId:t,callback:function(e){return console.log(e),Promise.resolve("Dummy response to keep the console quiet")}})}),200)})),o("hello")}))})();